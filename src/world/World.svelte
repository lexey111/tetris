<script>
	import Help from "../help/Help.svelte";
	import Score from "../score/Score.svelte";
	import Next from "../next/Next.svelte";
	import Scene from "../scene/Scene.svelte";

	const figs = 'SSS ZZZ II LLL TTT OO JJJ'.split('').filter(s => s !== ' '); // ['S', 'Z', 'I', 'L', 'T', 'O', 'J'];
	let fig = '';
	let v = 0;

	let num = 7;
	let text = 'START';

	setInterval(() => {
		text = '-' + num + '-';
		num += Math.floor(Math.random() * 10);
	}, 5000);

	setInterval(() => {
		fig = figs[Math.floor(Math.random() * figs.length)];
		v++; // for the same figures
	}, 2000);
</script>

<style>
	#screen-wrapper {
		position: absolute;
		top: 0;
		left: 0;
		right: 0;
		bottom: 0;
		overflow: hidden;
		display: flex;
		flex-flow: column nowrap;
		align-items: center;
	}

	#screen-content {
		margin: 0 auto;
		flex-grow: 2;
		width: 100%;
		display: flex;
		flex-flow: column nowrap;
	}

	#scene-container {
		width: auto;
		aspect-ratio: 1 / 2;
		height: 100%;
		align-self: center;
		position: relative;
	}

	#side-container {
		position: absolute;
		right: 0;
		top: 30px;
		transform: translateX(100%);
		width: 200px;
		display: flex;
		flex-flow: column nowrap;
		align-items: center;
		padding-top: 40px;
	}

	#help-content {
		margin-top: auto;
		width: 100%;
		display: flex;
		flex-flow: row nowrap;
		height: 100px;
		background: #06191f;
		justify-content: center;
		position: relative;
		flex-grow: 0;
		flex-shrink: 0;
		overflow: hidden;
	}

	#help-content:after {
		display: block;
		content: '';
		position: absolute;
		top: 0;
		left: 0;
		right: 0;
		height: 36px;
		background: linear-gradient(to bottom, #020b0c, transparent 90%);
	}

	@media screen and (max-width: 768px) {
		#screen-content {
			padding-bottom: 200px;
		}

		#side-container {
			left: 50%;
			right: unset;
			top: 100%;
			transform: translateX(-50%) translateY(-40px);
		}
	}

	@media screen and (max-width: 400px) {
		#help-content {
			display: none;
		}
	}
</style>

<div id="screen-wrapper">
    <div id="screen-content">
        <div id="scene-container">
            <div id="side-container">
                <Next type={fig} rnd={v}/>
                <Score text={text}/>
            </div>
            <Scene/>
        </div>
    </div>
    <div id="help-content">
        <Help/>
    </div>
</div>
<svg id="key" style="display: none" width="512" height="512" viewBox="0 0 512 512">
    <path id="Rounded-Rectangle" fill="#00a2ff" fill-rule="evenodd" stroke="none"
          d="M 0 472 C -0 494.0914 17.908609 512 40 512 L 472 512 C 494.0914 512 512 494.0914 512 472 L 512 40 C 512 17.9086 494.0914 0 472 0 L 40 0 C 17.908609 0 0 17.9086 0 40 Z"/>
</svg>
<svg id="arrow" style="display: none" width="512" height="512" viewBox="0 0 512 512">
    <path id="path1" fill="#a60000" fill-rule="evenodd" stroke="none"
          d="M 401.134705 458.87146 L 356.756165 503.25 L 109.578125 256.07196 L 356.756165 8.89389 L 401.134705 53.27243 L 198.335175 256.07196 Z"/>
</svg>
<svg id="rotate" style="display: none" width="512" height="512" viewBox="0 0 512 512">
    <path d="M125.7 160H176c17.7 0 32 14.3 32 32s-14.3 32-32 32H48c-17.7 0-32-14.3-32-32V64c0-17.7 14.3-32 32-32s32 14.3 32 32v51.2L97.6 97.6c87.5-87.5 229.3-87.5 316.8 0s87.5 229.3 0 316.8s-229.3 87.5-316.8 0c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0c62.5 62.5 163.8 62.5 226.3 0s62.5-163.8 0-226.3s-163.8-62.5-226.3 0L125.7 160z"/>
</svg>
<svg id="escape" style="display: none" width="512" height="512" viewBox="0 0 512 512">
    <path d="M 114.785156 439 L 114.785156 340.398438 L 187.097656 340.398438 L 187.097656 357.857422 L 134.921875 357.857422 L 134.921875 378.794922 L 182.816406 378.794922 L 182.816406 395.919922 L 134.921875 395.919922 L 134.921875 421.273438 L 189.507813 421.273438 L 189.507813 439 L 114.785156 439 Z M 197.333984 439 L 229.041016 388.761719 L 198.871094 340.398438 L 223.488281 340.398438 L 241.082031 372.439453 L 259.144531 340.398438 L 282.958984 340.398438 L 252.789063 387.958984 L 284.832031 439 L 259.8125 439 L 241.082031 405.417969 L 221.28125 439 L 197.333984 439 Z M 295.333984 439 L 295.333984 340.398438 L 315.804688 340.398438 L 315.804688 439 L 295.333984 439 Z M 356.408203 439 L 356.408203 357.857422 L 326.773438 357.857422 L 326.773438 340.398438 L 406.646484 340.398438 L 406.646484 357.857422 L 377.146484 357.857422 L 377.146484 439 L 356.408203 439 Z M 422.171875 233.865234 C 397.017517 233.865234 377.242249 225.796906 362.845703 209.660156 C 348.449158 193.444305 341.251953 171.215912 341.251953 142.976563 C 341.251953 112.443268 349.438446 88.911163 365.8125 72.378906 C 380.050842 57.982361 398.165955 50.785156 420.15625 50.785156 C 449.582123 50.785156 471.097595 60.433563 484.703125 79.734375 C 492.217804 90.57135 496.250977 101.449158 496.804688 112.365234 L 460.259766 112.365234 C 457.886719 103.980438 454.840851 97.652374 451.123047 93.380859 C 444.478485 85.787079 434.631897 81.990234 421.580078 81.990234 C 408.290955 81.990234 397.809601 87.348083 390.136719 98.066406 C 382.463837 108.784729 378.626953 123.953094 378.626953 143.570313 C 378.626953 163.187531 382.681122 177.881287 390.789063 187.650391 C 398.897003 197.419495 409.199158 202.302734 421.697266 202.302734 C 434.51178 202.302734 444.282196 198.111359 451.005859 189.726563 C 454.723663 185.217743 457.807617 178.455109 460.259766 169.4375 L 496.449219 169.4375 C 493.285126 188.501007 485.216858 204.004822 472.244141 215.949219 C 459.192322 227.893616 442.501007 233.865234 422.171875 233.865234 Z M 251.669922 233.507813 C 228.888596 233.507813 210.97171 228.308167 197.919922 217.90625 C 184.868134 207.504333 178.341797 193.207062 178.341797 175.013672 L 213.226563 175.013672 C 214.333984 183.00296 216.508774 188.974579 219.751953 192.929688 C 225.684601 200.12796 235.849564 203.726563 250.246094 203.726563 C 258.868195 203.726563 265.867157 202.777344 271.246094 200.878906 C 281.450256 197.240204 286.552734 190.4776 286.552734 180.589844 C 286.552734 174.815399 284.021515 170.345734 278.958984 167.181641 C 273.896454 164.096649 265.94635 161.369141 255.109375 158.996094 L 236.599609 154.841797 C 218.406189 150.728485 205.830109 146.25882 198.869141 141.433594 C 187.082977 133.365204 181.189453 120.749054 181.189453 103.583984 C 181.189453 87.921844 186.884735 74.909241 198.275391 64.546875 C 209.666046 54.184509 226.395432 49.003906 248.464844 49.003906 C 266.895538 49.003906 282.616638 53.889099 295.628906 63.658203 C 308.641174 73.427307 315.464844 87.606415 316.097656 106.195313 L 280.976563 106.195313 C 280.34375 95.674744 275.75589 88.199249 267.212891 83.769531 C 261.517548 80.842773 254.438492 79.378906 245.974609 79.378906 C 236.561508 79.378906 229.045929 81.277313 223.429688 85.074219 C 217.813446 88.871124 215.005859 94.171844 215.005859 100.974609 C 215.005859 107.223663 217.773407 111.889618 223.310547 114.974609 C 226.870132 117.03125 234.463837 119.444336 246.091797 122.212891 L 276.230469 129.451172 C 289.440491 132.615265 299.407196 136.846649 306.130859 142.146484 C 316.572327 150.373077 321.792969 162.27829 321.792969 177.861328 C 321.792969 193.839874 315.68219 207.107849 303.460938 217.667969 C 291.239685 228.228088 273.976624 233.507813 251.669922 233.507813 Z M 25.755859 229 L 25.755859 54.105469 L 154.017578 54.105469 L 154.017578 85.074219 L 61.46875 85.074219 L 61.46875 122.212891 L 146.423828 122.212891 L 146.423828 152.587891 L 61.46875 152.587891 L 61.46875 197.556641 L 158.289063 197.556641 L 158.289063 229 L 25.755859 229 Z"/>
</svg>
<svg id="pause" style="display: none" width="512" height="512" viewBox="0 0 512 512">
    <path d="M 255.365234 441.542969 C 238.28476 441.542969 226.689804 436.191467 220.580078 425.488281 C 217.324524 419.646149 215.695313 411.4841 215.695313 401.003906 L 215.695313 340.398438 L 236.634766 340.398438 L 236.634766 401.003906 C 236.634766 407.782593 237.437485 412.733704 239.042969 415.855469 C 241.540375 421.385437 246.981094 424.148438 255.365234 424.148438 C 263.704803 424.148438 269.121735 421.385437 271.619141 415.855469 C 273.224609 412.733704 274.027344 407.782593 274.027344 401.003906 L 274.027344 340.398438 L 294.966797 340.398438 L 294.966797 401.003906 C 294.966797 411.4841 293.337585 419.646149 290.082031 425.488281 C 284.016907 436.191467 272.445679 441.542969 255.365234 441.542969 Z M 351.224609 441.542969 C 338.380798 441.542969 328.280304 438.610535 320.921875 432.746094 C 313.563446 426.881653 309.882813 418.819702 309.882813 408.5625 L 329.550781 408.5625 C 330.17514 413.066742 331.402008 416.434235 333.230469 418.664063 C 336.575226 422.722351 342.305298 424.751953 350.421875 424.751953 C 355.282898 424.751953 359.229156 424.216797 362.261719 423.146484 C 368.014679 421.095032 370.890625 417.281586 370.890625 411.707031 C 370.890625 408.451477 369.463562 405.932312 366.609375 404.148438 C 363.755188 402.40918 359.273804 400.869141 353.164063 399.53125 L 342.728516 397.191406 C 332.471313 394.872375 325.381531 392.35321 321.457031 389.632813 C 314.812134 385.083984 311.488281 377.970398 311.488281 368.292969 C 311.488281 359.46286 314.699188 352.127319 321.121094 346.285156 C 327.542999 340.442993 336.975525 337.521484 349.417969 337.521484 C 359.80896 337.521484 368.671661 340.275513 376.007813 345.783203 C 383.343964 351.290894 387.192047 359.283508 387.548828 369.763672 L 367.748047 369.763672 C 367.391266 363.832336 364.804718 359.6185 359.988281 357.121094 C 356.777313 355.471008 352.785492 354.646484 348.013672 354.646484 C 342.706665 354.646484 338.469086 355.716797 335.302734 357.857422 C 332.136383 359.998047 330.554688 362.984985 330.554688 366.820313 C 330.554688 370.343445 332.114563 372.975586 335.236328 374.714844 C 337.243164 375.874359 341.524384 377.234039 348.080078 378.794922 L 365.072266 382.875 C 372.519897 384.658875 378.138977 387.045227 381.929688 390.033203 C 387.816437 394.671234 390.759766 401.382446 390.759766 410.167969 C 390.759766 419.176453 387.313995 426.657684 380.423828 432.611328 C 373.533661 438.564972 363.800842 441.542969 351.224609 441.542969 Z M 35.951172 439 L 35.951172 340.398438 L 78.896484 340.398438 C 88.796913 340.398438 96.691383 342.939423 102.578125 348.023438 C 108.464867 353.107452 111.408203 360.978149 111.408203 371.636719 C 111.408203 383.276428 108.464867 391.503906 102.578125 396.320313 C 96.691383 401.136719 88.283577 403.546875 77.357422 403.546875 L 56.419922 403.546875 L 56.419922 439 L 35.951172 439 Z M 109.802734 439 L 144.988281 340.398438 L 168.267578 340.398438 L 203.1875 439 L 180.84375 439 L 174.488281 418.730469 L 138.166016 418.730469 L 131.341797 439 L 109.802734 439 Z M 406.613281 439 L 406.613281 340.398438 L 478.925781 340.398438 L 478.925781 357.857422 L 426.748047 357.857422 L 426.748047 378.794922 L 474.644531 378.794922 L 474.644531 395.919922 L 426.748047 395.919922 L 426.748047 421.273438 L 481.333984 421.273438 L 481.333984 439 L 406.613281 439 Z M 143.716797 401.740234 L 168.736328 401.740234 L 156.427734 362.941406 L 143.716797 401.740234 Z M 56.419922 386.554688 L 75.619141 386.554688 C 80.480164 386.554688 84.269844 385.373383 86.990234 383.009766 C 89.666031 380.646149 91.003906 376.900085 91.003906 371.771484 C 91.003906 366.642883 89.655121 362.986023 86.957031 360.800781 C 84.258942 358.61554 80.480164 357.523438 75.619141 357.523438 L 56.419922 357.523438 L 56.419922 386.554688 Z M 267.746582 166.114258 L 230.608398 166.114258 L 230.608398 229 L 194.300781 229 L 194.300781 54.106445 L 270.475586 54.106445 C 288.036224 54.106445 302.037048 58.615204 312.478516 67.632813 C 322.919983 76.650421 328.140625 90.611725 328.140625 109.51709 C 328.140625 130.162689 322.919983 144.756805 312.478516 153.299805 C 302.037048 161.842804 287.126556 166.114258 267.746582 166.114258 Z M 284.83252 129.687988 C 289.578644 125.495575 291.95166 118.851105 291.95166 109.754395 C 291.95166 100.657684 289.558868 94.171417 284.773193 90.29541 C 279.987518 86.419403 273.283722 84.481445 264.661621 84.481445 L 230.608398 84.481445 L 230.608398 135.976563 L 264.661621 135.976563 C 273.283722 135.976563 280.007294 133.880402 284.83252 129.687988 Z"/>
</svg>
<svg id="drop" style="display: none" width="512" height="512" viewBox="0 0 512 512">
    <path d="M 310.017578 441.742188 C 295.925049 441.742188 285.154663 437.906921 277.707031 430.236328 C 267.717407 420.826477 262.722656 407.269257 262.722656 389.564453 C 262.722656 371.502869 267.717407 357.945618 277.707031 348.892578 C 285.154663 341.222015 295.925049 337.386719 310.017578 337.386719 C 324.110107 337.386719 334.880493 341.222015 342.328125 348.892578 C 352.273163 357.945618 357.244141 371.502869 357.244141 389.564453 C 357.244141 407.269257 352.273163 420.826477 342.328125 430.236328 C 334.880493 437.906921 324.110107 441.742188 310.017578 441.742188 Z M 68.527344 439 L 68.527344 340.398438 L 111.005859 340.398438 C 117.11557 340.48761 122.199547 341.201172 126.257813 342.539063 C 133.170288 344.813477 138.767563 348.98175 143.048828 355.046875 C 146.482758 359.952515 148.823563 365.260376 150.072266 370.96875 C 151.320969 376.677124 151.945313 382.117798 151.945313 387.291016 C 151.945313 400.402374 149.315125 411.505829 144.052734 420.603516 C 136.917282 432.867523 125.90107 439 111.005859 439 L 68.527344 439 Z M 167.933594 439 L 167.933594 340.398438 L 216.298828 340.398438 C 223.211304 340.532227 228.528137 341.378571 232.251953 342.939453 C 235.975769 344.500336 239.132141 346.797516 241.71875 349.830078 C 243.85939 352.327484 245.554031 355.092438 246.802734 358.125 C 248.051437 361.157562 248.675781 364.612305 248.675781 368.492188 C 248.675781 373.174835 247.492523 377.78009 245.128906 382.306641 C 242.765289 386.83316 238.864609 390.033203 233.423828 391.90625 C 237.972672 393.734711 241.194489 396.332184 243.089844 399.699219 C 244.985199 403.066254 245.931641 408.206696 245.931641 415.119141 L 245.931641 421.742188 C 245.931641 426.246429 246.110031 429.300781 246.466797 430.90625 C 247.001953 433.448242 248.250641 435.321289 250.212891 436.525391 L 250.212891 439 L 227.537109 439 C 226.91275 436.814758 226.466797 435.052734 226.199219 433.714844 C 225.664063 430.94986 225.372726 428.117523 225.328125 425.21875 L 225.195313 416.054688 C 225.106125 409.766602 223.957535 405.574554 221.75 403.478516 C 219.542465 401.382477 215.406937 400.335938 209.341797 400.335938 L 188.068359 400.335938 L 188.068359 439 L 167.933594 439 Z M 373.433594 439 L 373.433594 340.398438 L 416.378906 340.398438 C 426.279358 340.398438 434.173798 342.939423 440.060547 348.023438 C 445.947296 353.107452 448.890625 360.97818 448.890625 371.636719 C 448.890625 383.276367 445.947296 391.503906 440.060547 396.320313 C 434.173798 401.136719 425.767944 403.546875 414.841797 403.546875 L 393.902344 403.546875 L 393.902344 439 L 373.433594 439 Z M 310.017578 424.283203 C 318.178741 424.283203 324.667938 421.272461 329.484375 415.251953 C 334.256195 409.231445 336.640625 400.668976 336.640625 389.564453 C 336.640625 378.504547 334.243347 369.953003 329.449219 363.910156 C 324.65509 357.86731 318.178741 354.847656 310.017578 354.847656 C 301.856415 354.847656 295.345398 357.856415 290.484375 363.876953 C 285.623352 369.897491 283.193359 378.459961 283.193359 389.564453 C 283.193359 400.668976 285.623352 409.231445 290.484375 415.251953 C 295.345398 421.272461 301.856415 424.283203 310.017578 424.283203 Z M 88.529297 421.875 L 107.527344 421.875 C 117.249374 421.875 124.028 417.080444 127.863281 407.492188 C 129.95932 402.229797 131.007813 395.964539 131.007813 388.695313 C 131.007813 378.661133 129.445984 370.94696 126.324219 365.550781 C 123.15786 360.199188 116.892601 357.523438 107.527344 357.523438 L 88.529297 357.523438 L 88.529297 421.875 Z M 393.902344 386.554688 L 413.101563 386.554688 C 417.962585 386.554688 421.754211 385.373383 424.474609 383.009766 C 427.150391 380.646149 428.488281 376.900085 428.488281 371.771484 C 428.488281 366.642883 427.139496 362.986023 424.441406 360.800781 C 421.743317 358.61554 417.962585 357.523438 413.101563 357.523438 L 393.902344 357.523438 L 393.902344 386.554688 Z M 188.068359 384.011719 L 211.414063 384.011719 C 216.052109 384.011719 219.530594 383.476563 221.849609 382.40625 C 225.952499 380.533203 228.003906 376.832703 228.003906 371.302734 C 228.003906 365.326782 226.019882 361.313171 222.050781 359.261719 C 219.820953 358.102203 216.477234 357.523438 212.017578 357.523438 L 188.068359 357.523438 L 188.068359 384.011719 Z M 21.484375 275.75 L 21.484375 52.445313 L 81.046875 52.445313 L 81.046875 77.125 L 53.519531 77.125 L 53.519531 250.951172 L 81.046875 250.951172 L 81.046875 275.75 L 21.484375 275.75 Z M 430.359375 275.75 L 430.359375 250.951172 L 457.886719 250.951172 L 457.886719 76.650391 L 430.359375 76.650391 L 430.359375 52.445313 L 489.923828 52.445313 L 489.923828 275.75 L 430.359375 275.75 Z M 102.404297 229 L 102.404297 193.640625 L 138.355469 193.640625 L 138.355469 229 L 102.404297 229 Z M 372.457031 229 L 372.457031 193.640625 L 408.408203 193.640625 L 408.408203 229 L 372.457031 229 Z"/>
</svg>
